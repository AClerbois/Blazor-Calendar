@using System.Globalization
@using Blazor_Calendar.Models

@{
    double w = (WidthWindow / Months);
    string largeur = Convert.ToString(w, CultureInfo.InvariantCulture);
    string labelMonth = "";
    string labelDay = "";
    string CSSbackground = "";
    string taskContent = "";
    string taskColor = "";
}

<div class="calendar-contener">

@for (var month = 0; month <= Months; month++)
{
    m = FirstDate.AddMonths(month);
    labelMonth = new DateTime(m.Year, m.Month, 1).ToString("MMMM");

    <div class="month-column" style="width:@(largeur)px">
	    <div class="month month-cellule centertext noselect" >
            @labelMonth
        </div>
        
        @{
            day = new DateTime(m.Year, m.Month, 1);
        }

        @for (var i = 0; i < 31; i++)
        {
            CSSbackground = "";
            var j = day.AddDays(i);
            if (j.Month != m.Month)
            {
                labelDay = "";
                taskContent = "";
            }
            else
            {
                int d = (int)j.DayOfWeek;
                if (d == 6)
                {
                    CSSbackground = " Saturday";
                }
                else if (d == 0)
                {
                    CSSbackground = " Sunday";
                }

                string jour = j.ToString("ddd").Substring(0, 1).ToUpper();
                labelDay = $"{jour} {j.Day.ToString()}";
                
                taskContent = "";
                taskColor = "";
                for (var k = 0; k < TasksList.Length; k++)
                {
                     Tasks t = TasksList[k];

                     if ( t.DateStart.Date >= j.Date && j.Date >= t.DateEnd.Date  )
                    {
                        taskContent = t.Code;
                        taskColor = $"background:{t.Color}";
                        break;
                    }
                }
            }  
            <div class="day-cellule noselect">
                <div class="@($"day{CSSbackground}")">
                    @labelDay
                </div>
                <div class="task" style="@taskColor">
                     @taskContent
                </div>
            </div>        
            
        }
    </div>
}

</div>

